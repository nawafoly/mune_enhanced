<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ุฅุฏุงุฑุฉ ูุงูู โ ูุณุฎุฉ Firebase v4.0</title>

  <!-- โ๏ธ ุชูุช ุฅุฒุงูุฉ ุฃู ุณูุฑุจุช Firebase ูู <head> ูุชุฌููุจ ุงูุชููุฆุฉ ุงููุฒุฏูุฌุฉ -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- โ Topbar -->
  <div class="topbar">
    <div class="title">
      <h1>๐ฐ ุฅุฏุงุฑุฉ ูุงูู ุงูุดุฎุตูุฉ</h1>
      <div class="badge">v4.0</div>
    </div>
    <div class="topbar-actions">
      <div class="notification-badge" id="alertsCount" style="display: none;">
        <span id="alertsText">0 ุชูุจูู</span>
      </div>
    </div>
  </div>

  <!-- โ Container -->
  <div class="container">
    <!-- ุงูุฅุนุฏุงุฏุงุช ูุงูุชุญูู -->
    <section id="settings" class="card">
      <h2><span class="card-icon">โ๏ธ</span>ุงูุฅุนุฏุงุฏุงุช ูุงูุชุญูู</h2>
      <div class="toolbar">
        <div class="grow">
          <label>ุฑุงุชุจ ุงูุดูุฑ (ุฑ.ุณ)</label>
          <input id="salaryInput" type="number" placeholder="ูุซุงู: 7400">
        </div>
        <div class="grow">
          <label>ุงูุงุฏุฎุงุฑ ุงููุณุชูุฏู (ุฑ.ุณ)</label>
          <input id="savingTargetInput" type="number" placeholder="ูุซุงู: 1200">
        </div>
        <div class="grow">
          <label>ุงูุดูุฑ ุงููุนุฑูุถ</label>
          <input id="monthPicker" type="month">
        </div>
        <button id="saveSettingsBtn" class="btn primary">๐พ ุญูุธ</button>
      </div>

      <div class="toolbar mt-4">
        <label class="switch">
          <input type="checkbox" id="cashMode">
          <span class="slider"></span>
          ๐ต ูุถุน ููุฏู
        </label>
        <small class="muted">ูุญุณุจ ุงูุฃูุณุงุท/ุงูููุงุชูุฑ ุงููุนูููุฉ ยซูุฏููุนยป ููุท</small>

        <label class="switch">
          <input type="checkbox" id="autoDeduct">
          <span class="slider"></span>
          โก ุฎุตู ุชููุงุฆู
        </label>
        <small class="muted">ูุนูู ยซูุฏููุนยป ุชููุงุฆููุง ููู ุงูุงุณุชุญูุงู ุนูุฏ ูุชุญ ุงูุตูุญุฉ</small>

        <label class="switch">
          <input type="checkbox" id="rollover">
          <span class="slider"></span>
          ๐ ุชุฑุญูู ุงููุชุฃุฎุฑ
        </label>
        <small class="muted">ุฅูุดุงุก ุจูุฏ ุฎุงุฑุฌู ููุดูุฑ ุงูุชุงูู ูุฃู ูุณุท/ูุงุชูุฑุฉ ุบูุฑ ูุฏููุนุฉ</small>

        <label class="switch">
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
          ๐ ุงููุถุน ุงููุงุชุญ
        </label>
        <small class="muted">ุชุจุฏูู ุจูู ุงููุถุน ุงููุงุชุญ ูุงูุฏุงูู</small>
      </div>

      <button id="applySuggestedBtn" class="btn secondary mt-4">๐ ุงุนุชูุงุฏ ุงูุงุฏุฎุงุฑ ุงูููุชุฑุญ (15%)</button>
    </section>

    <!-- KPIs -->
    <div class="kpis">
      <div class="kpi"><div class="lbl">๐ฐ ุงูุฏุฎู ุงูุดูุฑู</div><div class="val" id="kpiIncome">ู ุฑ.ุณ</div></div>
      <div class="kpi"><div class="lbl">๐ธ ุฅุฌูุงูู ุงููุตุฑูู</div><div class="val" id="kpiExpense">ู ุฑ.ุณ</div></div>
      <div class="kpi"><div class="lbl">๐ฆ ุงูุงุฏุฎุงุฑ ุงููุญูู</div><div class="val" id="kpiSaving">ู ุฑ.ุณ</div></div>
      <div class="kpi"><div class="lbl">๐ต ุงูุตุงูู ุงููุชุจูู</div><div class="val" id="kpiNet">ู ุฑ.ุณ</div></div>
    </div>

    <!-- Charts -->
    <section id="charts" class="card">
      <h2><span class="card-icon">๐</span>ุงูุชุญูููุงุช ูุงูุฑุณูู ุงูุจูุงููุฉ</h2>
      <p class="muted">๐ ุชุญููู ูุงูู ุชูุงุนูู ูุน ุฑุณูู ุจูุงููุฉ ูุชูุฏูุฉ</p>
      <div class="charts">
        <div class="chart-container"><canvas id="trendChart"></canvas></div>
        <div class="chart-container"><canvas id="expenseChart"></canvas></div>
      </div>
    </section>

    <!-- ุงูุฃูุณุงุท ุงูุซุงุจุชุฉ -->
    <section id="installments" class="card">
      <h2><span class="card-icon">๐ฆ</span>ุงูุฃูุณุงุท ุงูุซุงุจุชุฉ</h2>
      <form id="instForm" class="toolbar">
        <input id="instName" placeholder="ุงุณู ุงููุณุท (ูุณุท ุณูุงุฑุฉ)" required>
        <input id="instAmount" type="number" placeholder="ูุจูุบ ุดูุฑู" required>
        <input id="instStart" type="month" required>
        <input id="instEnd" type="month" placeholder="(ุงุฎุชูุงุฑู) ุชุงุฑูุฎ ุงูุชูุงุก">
        <input id="instDueDay" type="number" min="1" max="31" placeholder="ููู ุงูุงุณุชุญูุงู">
        <button type="submit" class="btn primary">โ ุฅุถุงูุฉ</button>
      </form>
      <div class="table-container">
        <table class="table" id="instTable">
          <thead><tr><th>ุงูุงุณู</th><th>ุงููุจูุบ</th><th>ุงุณุชุญูุงู ูุฐุง ุงูุดูุฑ</th><th>ููู ุงูุงุณุชุญูุงู</th><th>ุงููุฏู</th><th>ุงูุญุงูุฉ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ุงูููุงุชูุฑ ุงูุดูุฑูุฉ -->
    <section id="bills" class="card">
      <h2><span class="card-icon">๐งพ</span>ุงูููุงุชูุฑ ุงูุดูุฑูุฉ</h2>
      <form id="billForm" class="toolbar">
        <input id="billName" placeholder="ุงุณู (ุฅูุชุฑูุช/ููุฑุจุงุก/ุฌูุงู)" required>
        <input id="billAmount" type="number" placeholder="ูุจูุบ ุดูุฑู" required>
        <input id="billStart" type="month" required>
        <input id="billEnd" type="month" placeholder="(ุงุฎุชูุงุฑู) ุชุงุฑูุฎ ุงูุชูุงุก">
        <input id="billDueDay" type="number" min="1" max="31" placeholder="ููู ุงูุงุณุชุญูุงู">
        <button type="submit" class="btn primary">โ ุฅุถุงูุฉ</button>
      </form>
      <div class="table-container">
        <table class="table" id="billTable">
          <thead><tr><th>ุงูุงุณู</th><th>ุงููุจูุบ</th><th>ุงุณุชุญูุงู ูุฐุง ุงูุดูุฑ</th><th>ููู ุงูุงุณุชุญูุงู</th><th>ุงููุฏู</th><th>ุงูุญุงูุฉ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ุงููุตุงุฑูู ุงูููููุฉ -->
    <section id="expenses" class="card">
      <h2><span class="card-icon">๐ณ</span>ุงููุตุงุฑูู ุงูููููุฉ</h2>
      <div class="toolbar">
        <input id="searchInput" placeholder="๐ ุจุญุซ ูู ุงููุตุงุฑูู ุงูููููุฉ..." class="grow">
        <button id="exportCSV" class="btn ghost">๐ ุชุตุฏูุฑ CSV</button>
        <button id="exportJSON" class="btn ghost">๐ ุชุตุฏูุฑ JSON</button>
        <button id="importData" class="btn ghost">๐ฅ ุงุณุชูุฑุงุฏ ุจูุงูุงุช</button>
      </div>
      <form id="expForm" class="toolbar">
        <input id="expDate" type="date" required>
        <input id="expCat" placeholder="ุชุตููู (ุฃูู/ููุงุตูุงุช)" required>
        <input id="expNote" placeholder="ููุงุญุธุฉ">
        <input id="expAmount" type="number" placeholder="ุงููุจูุบ" required>
        <select id="expPay">
          <option value="cash">๐ต ููุฏูุง</option>
          <option value="card">๐ณ ุจุทุงูุฉ</option>
          <option value="transfer">๐ฆ ุชุญููู</option>
          <option value="wallet">๐ฑ ูุญูุธุฉ ุฑูููุฉ</option>
        </select>
        <button type="submit" class="btn primary">โ ุฅุถุงูุฉ</button>
      </form>
      <div class="table-container">
        <table class="table" id="expTable">
          <thead><tr><th>ุงูุชุงุฑูุฎ</th><th>ุงูุชุตููู</th><th>ุงูููุงุญุธุฉ</th><th>ุทุฑููุฉ ุงูุฏูุน</th><th>ุงููุจูุบ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ูุตุงุฑูู ุฎุงุฑุฌูุฉ -->
    <section id="external" class="card">
      <h2><span class="card-icon">โ๏ธ</span>ูุตุงุฑูู ุฎุงุฑุฌูุฉ</h2>
      <form id="oneForm" class="toolbar">
        <input id="oneDate" type="date" required>
        <input id="oneCat" placeholder="ุงูููุน (ูุฎุงููุฉ/ุฑุณูู ุญููููุฉ...)" required>
        <input id="oneNote" placeholder="ููุงุญุธุฉ">
        <input id="oneAmount" type="number" placeholder="ุงููุจูุบ" required>
        <label class="switch">
          <input type="checkbox" id="onePaid">
          <span class="slider"></span>
          โ ูุฏููุนุฉ ุงูุขู
        </label>
        <button type="submit" class="btn primary">โ ุฅุถุงูุฉ</button>
      </form>
      <div class="table-container">
        <table class="table" id="oneTable">
          <thead><tr><th>ุงูุชุงุฑูุฎ</th><th>ุงูููุน</th><th>ุงูููุงุญุธุฉ</th><th>ุงููุจูุบ</th><th>ุงูุญุงูุฉ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ููุฒุงููุงุช ุงูุชุตูููุงุช -->
    <section id="budgets" class="card">
      <h2><span class="card-icon">๐ฏ</span>ููุฒุงููุงุช ุงูุชุตูููุงุช</h2>
      <form id="budForm" class="toolbar">
        <input id="budCat" placeholder="ุชุตููู (ุฃูู/ููุงุตูุงุช/โฆ)" required>
        <input id="budLimit" type="number" placeholder="ุงูุญุฏ ุงูุดูุฑู (ุฑ.ุณ)" required>
        <button type="submit" class="btn primary">๐พ ุญูุธ ุงูููุฒุงููุฉ</button>
      </form>
      <div class="table-container">
        <table class="table" id="budTable">
          <thead><tr><th>ุงูุชุตููู</th><th>ุงูุญุฏ ุงููุญุฏุฏ</th><th>ุงููุตุฑูู ุงูุญุงูู</th><th>ุงููุณุจุฉ ุงููุณุชูููุฉ</th><th>ุงูุญุงูุฉ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ุงูููุฎุต ุงูุดูุฑู ุงูุชูุตููู -->
    <section id="summary" class="card">
      <h2><span class="card-icon">๐</span>ุงูููุฎุต ุงูุดูุฑู ุงูุชูุตููู</h2>
      <div class="toolbar">
        <button id="generateReport" class="btn secondary">๐ ุชูุฑูุฑ ููุตู</button>
        <button id="compareMonths" class="btn secondary">๐ ููุงุฑูุฉ ุงูุฃุดูุฑ</button>
        <button id="exportSummary" class="btn ghost">๐ ุชุตุฏูุฑ ุงูููุฎุต</button>
      </div>
      <div id="monthSummary"></div>
    </section>
  </div>

  <!-- โ Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="#settings" class="active"><span class="icon">โ๏ธ</span><span class="label">ุฅุนุฏุงุฏุงุช</span></a>
    <a href="#expenses"><span class="icon">๐ณ</span><span class="label">ูุตุงุฑูู</span></a>
    <a href="#budgets"><span class="icon">๐ฏ</span><span class="label">ููุฒุงููุงุช</span></a>
    <a href="#installments"><span class="icon">๐ฆ</span><span class="label">ุฃูุณุงุท</span></a>
    <a href="#bills"><span class="icon">๐งพ</span><span class="label">ููุงุชูุฑ</span></a>
    <a href="#charts"><span class="icon">๐</span><span class="label">ุฑุณูู</span></a>
  </nav>

  <!-- โ FAB -->
  <button class="fab" id="fabAdd">โ</button>

  <!-- โ Toast -->
  <div id="toast" class="toast"></div>

  <!-- โ Quick Add Modal -->
  <div class="modal" id="quickModal">
    <div class="sheet">
      <div class="handle"></div>
      <h3>๐ฐ ุฅุถุงูุฉ ูุตุฑูู ุณุฑูุน</h3>
      <form id="quickForm">
        <input id="qDate" type="date" required>
        <select id="qPay">
          <option value="cash">๐ต ููุฏูุง</option>
          <option value="card">๐ณ ุจุทุงูุฉ</option>
          <option value="transfer">๐ฆ ุชุญููู</option>
          <option value="wallet">๐ฑ ูุญูุธุฉ ุฑูููุฉ</option>
        </select>
        <input id="qCat" placeholder="ุชุตููู" required>
        <input id="qAmount" type="number" placeholder="ุงููุจูุบ (ุฑ.ุณ)" required>
        <input id="qNote" class="full" placeholder="ููุงุญุธุฉ (ุงุฎุชูุงุฑู)">
        <div class="full flex gap-4 mt-4">
          <button class="btn ghost" id="qCancel" type="button">โ ุฅูุบุงุก</button>
          <button class="btn primary" type="submit">๐พ ุญูุธ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- โ Import Modal -->
  <div class="modal" id="importModal">
    <div class="sheet">
      <div class="handle"></div>
      <h3>๐ฅ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</h3>
      <div class="mb-4">
        <label class="muted">ุงุฎุชุฑ ููู JSON ุฃู CSV:</label>
        <input type="file" id="importFile" accept=".json,.csv" class="mt-2">
      </div>
      <div class="flex gap-4">
        <button class="btn ghost" id="importCancel">โ ุฅูุบุงุก</button>
        <button class="btn primary" id="importConfirm">๐ฅ ุงุณุชูุฑุงุฏ</button>
      </div>
    </div>
  </div>

  <!-- ๐ฅ Firebase (Compat) ุนุจุฑ CDN โ ุงูุชุญููู ููุง ููุท -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- ูููุงุชู (ูุฐุง ุงูุชุฑุชูุจ ููู) -->
  <script src="./firebase.js"></script>
  <script defer src="./main.js"></script>
</body>
</html>
