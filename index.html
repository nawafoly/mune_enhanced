<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>تجربة الخط والمتغيّرات</title>

    <!-- تحسين الاتصال قبل تحميل الخط -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- خط Tajawal بالأوزان المطلوبة -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap"
        rel="style.css">

    <link rel="stylesheet" href="style.css">
    <script src="main.js" defer></script>



    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDJtbThBhZr4bmIoxTr55seoU3VoSC4ZuU",
            authDomain: "index-599e8.firebaseapp.com",
            projectId: "index-599e8",
            storageBucket: "index-599e8.firebasestorage.app",
            messagingSenderId: "57008792504",
            appId: "1:57008792504:web:16c083ad855e787143254d",
            measurementId: "G-CQNV5H3RKG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // لحفظ بيانات
        async function saveData() {
            try {
                await addDoc(collection(db, "users"), {
                    name: "نواف",
                    message: "مرحبًا من Firebase!"
                });
                alert("✅ تم الحفظ بنجاح");
            } catch (e) {
                console.error("❌ خطأ في الحفظ:", e);
            }
        }

        // لعرض البيانات
        async function getData() {
            const querySnapshot = await getDocs(collection(db, "users"));
            querySnapshot.forEach((doc) => {
                console.log(`${doc.id} =>`, doc.data());
            });
        }

        window.saveData = saveData;
        window.getData = getData;
    </script>
</head>

<body>
    <div class="topbar">
        <div class="title">
            <div>
                <span class="badge">v3.0</span>
                <h1>💰 إدارة مالي الشخصية</h1>
            </div>
            <div class="topbar-actions">
                <div class="notification-badge" id="alertsCount" style="display: none;">
                    <span id="alertsText">0 تنبيه</span>
                </div>
            </div>
        </div>
    </div>

    <main class="container grid cols-2">
        <!-- ✅ الإعدادات المحسنة -->
        <section id="settings" class="card">
            <h2><span class="card-icon">⚙️</span>الإعدادات والتحكم</h2>
            <div class="toolbar">
                <div class="grow">
                    <label class="muted">راتب الشهر (ر.س)</label>
                    <input id="salaryInput" type="number" placeholder="مثال: 7400" />
                </div>
                <div class="grow">
                    <label class="muted">الادخار المستهدف (ر.س)</label>
                    <input id="savingTargetInput" type="number" placeholder="مثال: 1200" />
                </div>
                <div>
                    <label class="muted">الشهر المعروض</label>
                    <input id="monthPicker" type="month" />
                </div>
                <div>
                    <button id="saveSettingsBtn" class="btn primary">💾 حفظ</button>
                </div>
            </div>

            <div class="sep"></div>

            <div class="setting">
                <label class="switch">
                    <input id="cashMode" type="checkbox" />
                    <span class="slider"></span>
                </label>
                <div class="info">
                    <div class="title">💵 وضع نقدي</div>
                    <div class="desc">يحسب الأقساط/الفواتير المعلّمة «مدفوع» فقط</div>
                </div>
            </div>

            <div class="setting">
                <label class="switch">
                    <input id="autoDeduct" type="checkbox" />
                    <span class="slider"></span>
                </label>
                <div class="info">
                    <div class="title">⚡ خصم تلقائي</div>
                    <div class="desc">يعلم «مدفوع» تلقائيًا يوم الاستحقاق عند فتح الصفحة</div>
                </div>
            </div>

            <div class="setting">
                <label class="switch">
                    <input id="rollover" type="checkbox" />
                    <span class="slider"></span>
                </label>
                <div class="info">
                    <div class="title">📋 ترحيل المتأخر</div>
                    <div class="desc">إنشاء بند خارجي للشهر التالي لأي قسط/فاتورة غير مدفوعة</div>
                </div>
            </div>

            <div class="setting">
                <label class="switch">
                    <input id="themeToggle" type="checkbox" />
                    <span class="slider"></span>
                </label>
                <div class="info">
                    <div class="title">🌞 الوضع الفاتح</div>
                    <div class="desc">تبديل بين الوضع الفاتح والداكن</div>
                </div>
            </div>

            <div class="sep"></div>

            <div class="toolbar">
                <button id="applySuggestedBtn" class="btn secondary">📊 اعتماد الادخار المقترح (15%)</button>
                <span id="savingSuggestion" class="muted"></span>
            </div>

            <div class="kpis">
                <div class="kpi">
                    <div class="lbl">💰 الدخل الشهري</div>
                    <div class="val" id="kpiIncome">0</div>
                    <div class="trend up" id="incomeTrend" style="display: none;">
                        <span>↗️</span> +5.2%
                    </div>
                </div>
                <div class="kpi">
                    <div class="lbl">💸 إجمالي المصروف</div>
                    <div class="val" id="kpiOut">0</div>
                    <div class="trend down" id="expenseTrend" style="display: none;">
                        <span>↘️</span> -2.1%
                    </div>
                </div>
                <div class="kpi">
                    <div class="lbl">🏦 الادخار المحقق</div>
                    <div class="val" id="kpiSave">0</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="savingProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="kpi">
                    <div class="lbl">💵 الصافي المتبقي</div>
                    <div class="val" id="kpiNet">0</div>
                    <div class="trend" id="netTrend" style="display: none;">
                        <span>📈</span> متوازن
                    </div>
                </div>
            </div>
        </section>

        <!-- ✅ الرسوم البيانية المحسنة -->
        <section id="chartsSec" class="card">
            <h2><span class="card-icon">📊</span>التحليلات والرسوم البيانية</h2>
            <div class="charts">
                <div class="chart-container">
                    <canvas id="chartMonthly"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="chartBreakdown"></canvas>
                </div>
            </div>
            <div class="muted text-center mt-4">
                📈 تحليل مالي تفاعلي مع رسوم بيانية متقدمة
            </div>
        </section>

        <!-- ✅ الأقساط المحسنة -->
        <section id="instSec" class="card">
            <h2><span class="card-icon">🏦</span>الأقساط الثابتة</h2>
            <form id="instForm" class="toolbar">
                <input id="instName" class="grow" placeholder="اسم القسط (قسط سيارة)" required />
                <input id="instAmount" type="number" placeholder="مبلغ شهري" required />
                <input id="instStart" type="date" required />
                <input id="instEnd" type="date" placeholder="(اختياري) تاريخ انتهاء" />
                <input id="instDueDay" type="number" min="1" max="31" placeholder="يوم الاستحقاق" />
                <button class="btn success">➕ إضافة</button>
            </form>
            <div class="table-container">
                <table class="table" id="instTable">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th class="fit">المبلغ</th>
                            <th class="fit">المدى</th>
                            <th class="fit">يوم الاستحقاق</th>
                            <th class="fit">استحقاق هذا الشهر</th>
                            <th class="fit">الحالة</th>
                            <th class="fit">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- ✅ الفواتير المحسنة -->
        <section id="billsSec" class="card">
            <h2><span class="card-icon">🧾</span>الفواتير الشهرية</h2>
            <form id="billForm" class="toolbar">
                <input id="billName" class="grow" placeholder="اسم (إنترنت/كهرباء/جوال)" required />
                <input id="billAmount" type="number" placeholder="مبلغ شهري" required />
                <input id="billStart" type="date" required />
                <input id="billEnd" type="date" placeholder="(اختياري) تاريخ انتهاء" />
                <input id="billDueDay" type="number" min="1" max="31" placeholder="يوم الاستحقاق" />
                <button class="btn success">➕ إضافة</button>
            </form>
            <div class="table-container">
                <table class="table" id="billTable">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th class="fit">المبلغ</th>
                            <th class="fit">المدى</th>
                            <th class="fit">يوم الاستحقاق</th>
                            <th class="fit">استحقاق هذا الشهر</th>
                            <th class="fit">الحالة</th>
                            <th class="fit">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- ✅ المصاريف المحسنة -->
        <section id="expSec" class="card">
            <h2><span class="card-icon">💳</span>المصاريف اليومية</h2>
            <form id="expForm" class="toolbar">
                <input id="expDate" type="date" required />
                <input id="expCat" class="grow" placeholder="تصنيف (أكل/مواصلات)" required />
                <input id="expNote" class="grow" placeholder="ملاحظة" />
                <input id="expAmount" type="number" placeholder="المبلغ" required />
                <select id="expPay" title="طريقة الدفع">
                    <option value="cash">💵 نقدًا</option>
                    <option value="card">💳 بطاقة</option>
                    <option value="transfer">🏦 تحويل</option>
                    <option value="wallet">📱 محفظة رقمية</option>
                </select>
                <button class="btn success">➕ إضافة</button>
            </form>
            <div class="toolbar mt-4">
                <input id="searchInput" class="grow" placeholder="🔍 بحث في المصاريف اليومية..." />
                <button id="exportCSV" type="button" class="btn ghost">📄 تصدير CSV</button>
                <button id="exportJSON" type="button" class="btn ghost">📋 تصدير JSON</button>
                <button id="importData" type="button" class="btn secondary">📥 استيراد بيانات</button>
            </div>
            <div class="table-container">
                <table class="table" id="expTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>التصنيف</th>
                            <th>الوصف</th>
                            <th class="fit">طريقة الدفع</th>
                            <th class="fit">المبلغ</th>
                            <th class="fit">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4"><strong>إجمالي المعروض</strong></td>
                            <td id="expShownTotal"><strong>0</strong></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- ✅ المصاريف الخارجية المحسنة -->
        <section id="oneSec" class="card">
            <h2><span class="card-icon">⚠️</span>مصاريف خارجية</h2>
            <form id="oneForm" class="toolbar">
                <input id="oneDate" type="date" required />
                <input id="oneCat" class="grow" placeholder="النوع (مخالفة/رسوم حكومية...)" required />
                <input id="oneNote" class="grow" placeholder="ملاحظة" />
                <input id="oneAmount" type="number" placeholder="المبلغ" required />
                <label class="muted flex items-center gap-2">
                    <input id="onePaid" type="checkbox" />
                    ✅ مدفوعة الآن
                </label>
                <button class="btn warning">➕ إضافة</button>
            </form>
            <div class="table-container">
                <table class="table" id="oneTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>النوع</th>
                            <th>ملاحظة</th>
                            <th class="fit">المبلغ</th>
                            <th class="fit">الحالة</th>
                            <th class="fit">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- ✅ الميزانيات المحسنة -->
        <section id="budgetsSec" class="card">
            <h2><span class="card-icon">🎯</span>ميزانيات التصنيفات</h2>
            <form id="budForm" class="toolbar">
                <input id="budCat" class="grow" placeholder="تصنيف (أكل/مواصلات/…)" required>
                <input id="budLimit" type="number" placeholder="الحد الشهري (ر.س)" required>
                <button class="btn primary">💾 حفظ الميزانية</button>
            </form>
            <div class="table-container">
                <table class="table" id="budTable">
                    <thead>
                        <tr>
                            <th>التصنيف</th>
                            <th class="fit">الحد المحدد</th>
                            <th class="fit">المصروف الحالي</th>
                            <th class="fit">النسبة المستخدمة</th>
                            <th class="fit">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- ✅ الملخص الشهري المحسن -->
        <section id="summarySec" class="card">
            <h2><span class="card-icon">📋</span>الملخص الشهري التفصيلي</h2>
            <div class="table-container">
                <table class="table" id="monthSummary"></table>
            </div>
            <div class="toolbar mt-4">
                <button id="generateReport" class="btn primary">📊 تقرير مفصل</button>
                <button id="compareMonths" class="btn secondary">📈 مقارنة الأشهر</button>
                <button id="exportSummary" class="btn ghost">📄 تصدير الملخص</button>
            </div>
        </section>

        <button onclick="saveData()">💾 حفظ تجربة</button>
        <button onclick="getData()">📄 عرض البيانات</button>

    </main>

    <!-- ✅ زر الإضافة السريعة المحسن -->
    <div class="fab-wrap">
        <button class="fab" id="fabAdd" aria-label="إضافة مصروف سريع">
            ➕
        </button>
    </div>

    <!-- ✅ شريط التنقل السفلي المحسن -->
    <nav class="bottom-nav">
        <a href="#summarySec" data-section="summary">
            📋<br>ملخص
        </a>
        <a href="#expSec" data-section="expenses">
            💳<br>مصاريف
        </a>
        <a href="#budgetsSec" data-section="budgets">
            🎯<br>ميزانيات
        </a>
        <a href="#instSec" data-section="installments">
            🏦<br>أقساط
        </a>
        <a href="#billsSec" data-section="bills">
            🧾<br>فواتير
        </a>
        <a href="#chartsSec" data-section="charts">
            📊<br>رسوم
        </a>
    </nav>

    <!-- ✅ نظام التنبيهات -->
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" style="display:none"></div>

    <!-- ✅ نافذة الإضافة السريعة المحسنة -->
    <div class="modal" id="quickModal">
        <div class="sheet">
            <div class="handle"></div>
            <h3>💰 إضافة مصروف سريع</h3>
            <form id="quickForm">
                <input id="qDate" type="date" required>
                <select id="qPay">
                    <option value="cash">💵 نقدًا</option>
                    <option value="card">💳 بطاقة</option>
                    <option value="transfer">🏦 تحويل</option>
                    <option value="wallet">📱 محفظة رقمية</option>
                </select>
                <input id="qCat" placeholder="تصنيف" required>
                <input id="qAmount" type="number" placeholder="المبلغ (ر.س)" required>
                <input id="qNote" class="full" placeholder="ملاحظة (اختياري)">
                <div class="full flex gap-4 mt-4">
                    <button class="btn ghost" id="qCancel" type="button">❌ إلغاء</button>
                    <button class="btn primary" type="submit">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ✅ نافذة استيراد البيانات -->
    <div class="modal" id="importModal">
        <div class="sheet">
            <div class="handle"></div>
            <h3>📥 استيراد البيانات</h3>
            <div class="mb-4">
                <label class="muted">اختر ملف JSON أو CSV:</label>
                <input type="file" id="importFile" accept=".json,.csv" class="mt-2">
            </div>
            <div class="flex gap-4">
                <button class="btn ghost" id="importCancel">❌ إلغاء</button>
                <button class="btn primary" id="importConfirm">📥 استيراد</button>
            </div>
        </div>
    </div>

</body>

</html>
